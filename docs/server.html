<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-server" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Cerebellum WebSocket Server | Cerebellum</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cerebellum-realtime.github.io/img/cerebellum_transparent.png"><meta data-rh="true" name="twitter:image" content="https://cerebellum-realtime.github.io/img/cerebellum_transparent.png"><meta data-rh="true" property="og:url" content="https://cerebellum-realtime.github.io/docs/server"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cerebellum WebSocket Server | Cerebellum"><meta data-rh="true" name="description" content="Cerebellum WebSocket Server"><meta data-rh="true" property="og:description" content="Cerebellum WebSocket Server"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cerebellum-realtime.github.io/docs/server"><link data-rh="true" rel="alternate" href="https://cerebellum-realtime.github.io/docs/server" hreflang="en"><link data-rh="true" rel="alternate" href="https://cerebellum-realtime.github.io/docs/server" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.1efe0463.css">
<script src="/assets/js/runtime~main.161438b6.js" defer="defer"></script>
<script src="/assets/js/main.2ec95f51.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Cerebellum Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Cerebellum Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cerebellum</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/case-study">Case Study</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/using-cerebellum">Docs</a><a class="navbar__item navbar__link" href="/team">Team</a><a href="https://github.com/cerebellum-realtime" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/using-cerebellum">Using Cerebellum</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">Cerebellum CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/server">Cerebellum WebSocket Server</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/SDK/Getting_Started">SDK</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cerebellum WebSocket Server</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Cerebellum WebSocket Server</h1>
<p>This is the Cerebellum WebSocket server designed for realtime applications. The server runs on port <strong>8001</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-your-environment">Setting up your environment<a href="#setting-up-your-environment" class="hash-link" aria-label="Direct link to Setting up your environment" title="Direct link to Setting up your environment">​</a></h3>
<p>Clone the repo.</p>
<p>Install node dependencies. <code>cd</code> into the project root and run <code>npm install</code>.</p>
<p>Create a <code>.env</code> file in the project root and then copy the content from <code>.env.example</code>. Fill out the values according to your local development environment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-a-local-development-server">Running a local development server<a href="#running-a-local-development-server" class="hash-link" aria-label="Direct link to Running a local development server" title="Direct link to Running a local development server">​</a></h3>
<ul>
<li>Start running Docker locally.</li>
<li><code>cd</code> into the project root and run:</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker compose up --detach</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>docker compose up --detach</code> starts running local docker images of Redis and DynamoDB in the background.</li>
<li><code>npm run dev</code> starts running a local instance of the Cerebellum WebSocket server on <strong>port 8001</strong>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-server-in-production">Running the server in production<a href="#running-the-server-in-production" class="hash-link" aria-label="Direct link to Running the server in production" title="Direct link to Running the server in production">​</a></h3>
<p>For production, this server is dockerized and its image is used in our AWS CDK infrastructure deployment.</p>
<p>Note: While deploying the AWS infrastructure with the CDK, the environment variables needed for the server will be added automatically during deployment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparing-for-production">Preparing for production<a href="#preparing-for-production" class="hash-link" aria-label="Direct link to Preparing for production" title="Direct link to Preparing for production">​</a></h3>
<p>To dockerize this image:</p>
<ul>
<li>Run <code>docker login</code> to make sure you are logged in to your Dockerhub account.</li>
<li><code>cd</code> into the project root directory</li>
<li>Create a local Docker image<!-- -->
<ul>
<li><code>docker build -t &lt;your-dockerhub-username&gt;/&lt;image-name&gt;:&lt;tag&gt; .</code></li>
</ul>
</li>
<li>Push the Docker image to Dockerhub<!-- -->
<ul>
<li><code>docker push &lt;your-dockerhub-username&gt;/&lt;image-name&gt;:&lt;tag&gt;</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="placing-server-into-production">Placing server into production<a href="#placing-server-into-production" class="hash-link" aria-label="Direct link to Placing server into production" title="Direct link to Placing server into production">​</a></h3>
<p>To use this Docker image in production:</p>
<ul>
<li>Install Cerebellum&#x27;s CLI package globally:<!-- -->
<ul>
<li><code>npm install --global @cerebellum/cli</code></li>
</ul>
</li>
<li><code>cd</code> into a folder with no <code>.git</code> repo</li>
<li>Create the CDK infrastructure deployment folder by running:<!-- -->
<ul>
<li><code>cerebellum create</code>
<ul>
<li>In the option asking if you want to use your server image, insert the Docker image just created.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For deploying Cerebellum&#x27;s CDK and more information about our <a href="https://github.com/Cerebellum-Realtime/cli" target="_blank" rel="noopener noreferrer">CLI</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-included">What&#x27;s Included<a href="#whats-included" class="hash-link" aria-label="Direct link to What&#x27;s Included" title="Direct link to What&#x27;s Included">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authentication">Authentication<a href="#authentication" class="hash-link" aria-label="Direct link to Authentication" title="Direct link to Authentication">​</a></h3>
<p>Cerebellum&#x27;s server implements a way to authenticate users before a WebSocket connection is established in order to protect the server. This gives our server protection from unwanted users connecting.</p>
<p>Steps to authenticate:</p>
<ul>
<li>Create an API key<!-- -->
<ul>
<li>Checkout Cerebellum&#x27;s <a href="https://github.com/Cerebellum-Realtime/cli" target="_blank" rel="noopener noreferrer">CLI</a> for more information on deploying using Cerebellum</li>
</ul>
</li>
<li>Place the API key into the server <code>.env</code> as <code>API_KEY=&lt;your_api_key&gt;</code></li>
<li>Create a separate authentication server and give it the API key</li>
</ul>
<p>In practice, this is how authentication works:</p>
<ul>
<li>A client attempts to login via a separate authentication server (not Cerebellum&#x27;s server)</li>
<li>Once the clients&#x27; login is successful, the client is given a JWT token</li>
<li>The client then gives the JWT token to the Cerebellum server and the Cerebellum server authenticates the JWT token</li>
<li>Assuming the JWT token was built with the same secret, the user is granted permission to connect to the Cerebellum server via WebSocket</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scalable-realtime-communication">Scalable Realtime Communication<a href="#scalable-realtime-communication" class="hash-link" aria-label="Direct link to Scalable Realtime Communication" title="Direct link to Scalable Realtime Communication">​</a></h3>
<p>To be able to handle high traffic usage, Cerebellum&#x27;s server is designed to be easily scalable. To do this, we rely on a Redis cache that will act as a message facilitator between servers. This means that we can horizontally scale (i.e., add more servers) and have a way for all servers to communicate.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-data-storage-capability">Persistent Data Storage Capability<a href="#persistent-data-storage-capability" class="hash-link" aria-label="Direct link to Persistent Data Storage Capability" title="Direct link to Persistent Data Storage Capability">​</a></h3>
<p>The Cerebellum server is designed to save realtime data to DynamoDB.</p>
<ul>
<li>In development mode, data is written directly to a running docker instance of DynamoDB.</li>
<li>In production mode, the server is designed to send data to a queue.<!-- -->
<ul>
<li>Note: An AWS Lambda function will use Dynamoose and send data to the database.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connection-state-recovery">Connection State Recovery<a href="#connection-state-recovery" class="hash-link" aria-label="Direct link to Connection State Recovery" title="Direct link to Connection State Recovery">​</a></h3>
<p>The Cerebellum server is designed to handle dropped connections re-connecting quickly and without re-authentication. We use Socket.io&#x27;s built-in connection state recovery. The max re-connect timeframe is set to 120 seconds and skip the middleware (which skips authentication).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="realtime-presence">Realtime Presence<a href="#realtime-presence" class="hash-link" aria-label="Direct link to Realtime Presence" title="Direct link to Realtime Presence">​</a></h3>
<p>The Cerebellum server is designed for realtime presence. This means that our server gives the capability for users to see realtime updates from other users in their channel. We utilize Redis streams by saving the presence of channels on the Redis temporarily. The server can then implement presence by:</p>
<ul>
<li>adding a user to the channel&#x27;s presence</li>
<li>removing a user from a channel&#x27;s presence</li>
<li>getting all users from a channel&#x27;s presence</li>
<li>updating a user&#x27;s info in the channel&#x27;s presence</li>
<li>getting all channels a user is present in</li>
<li>removing a user from all channel&#x27;s presence</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/cli"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cerebellum CLI</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/SDK/Getting_Started"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started with the SDK</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a><ul><li><a href="#setting-up-your-environment" class="table-of-contents__link toc-highlight">Setting up your environment</a></li><li><a href="#running-a-local-development-server" class="table-of-contents__link toc-highlight">Running a local development server</a></li><li><a href="#running-the-server-in-production" class="table-of-contents__link toc-highlight">Running the server in production</a></li><li><a href="#preparing-for-production" class="table-of-contents__link toc-highlight">Preparing for production</a></li><li><a href="#placing-server-into-production" class="table-of-contents__link toc-highlight">Placing server into production</a></li></ul></li><li><a href="#whats-included" class="table-of-contents__link toc-highlight">What&#39;s Included</a><ul><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li><li><a href="#scalable-realtime-communication" class="table-of-contents__link toc-highlight">Scalable Realtime Communication</a></li><li><a href="#persistent-data-storage-capability" class="table-of-contents__link toc-highlight">Persistent Data Storage Capability</a></li><li><a href="#connection-state-recovery" class="table-of-contents__link toc-highlight">Connection State Recovery</a></li><li><a href="#realtime-presence" class="table-of-contents__link toc-highlight">Realtime Presence</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Navigation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/case-study">Case Study</a></li><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/using-cerebellum">Docs</a></li><li class="footer__item"><a href="https://github.com/cerebellum-realtime" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/logo.png" alt="Cerebellum Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/logo.png" alt="Cerebellum Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2024 Cerebellum</div></div></div></footer></div>
</body>
</html>