"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[739],{5347:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});var i=r(4848),t=r(8453);const s={title:"Cerebellum WebSocket Server",description:"Cerebellum WebSocket Server",sidebar_position:2},l="Cerebellum WebSocket Server",o={id:"server",title:"Cerebellum WebSocket Server",description:"Cerebellum WebSocket Server",source:"@site/docs/server.md",sourceDirName:".",slug:"/server",permalink:"/docs/server",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Cerebellum WebSocket Server",description:"Cerebellum WebSocket Server",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Cerebellum CLI",permalink:"/docs/cli"},next:{title:"Getting Started with the SDK",permalink:"/docs/SDK/Getting_Started"}},c={},a=[{value:"Getting Started",id:"getting-started",level:2},{value:"Setting up your environment",id:"setting-up-your-environment",level:3},{value:"Running a local development server",id:"running-a-local-development-server",level:3},{value:"Running the server in production",id:"running-the-server-in-production",level:3},{value:"Preparing for production",id:"preparing-for-production",level:3},{value:"Placing server into production",id:"placing-server-into-production",level:3},{value:"What&#39;s Included",id:"whats-included",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Scalable Realtime Communication",id:"scalable-realtime-communication",level:3},{value:"Persistent Data Storage Capability",id:"persistent-data-storage-capability",level:3},{value:"Connection State Recovery",id:"connection-state-recovery",level:3},{value:"Realtime Presence",id:"realtime-presence",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"cerebellum-websocket-server",children:"Cerebellum WebSocket Server"}),"\n",(0,i.jsxs)(n.p,{children:["This is the Cerebellum WebSocket server designed for realtime applications. The server runs on port ",(0,i.jsx)(n.strong,{children:"8001"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(n.h3,{id:"setting-up-your-environment",children:"Setting up your environment"}),"\n",(0,i.jsx)(n.p,{children:"Clone the repo."}),"\n",(0,i.jsxs)(n.p,{children:["Install node dependencies. ",(0,i.jsx)(n.code,{children:"cd"})," into the project root and run ",(0,i.jsx)(n.code,{children:"npm install"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Create a ",(0,i.jsx)(n.code,{children:".env"})," file in the project root and then copy the content from ",(0,i.jsx)(n.code,{children:".env.example"}),". Fill out the values according to your local development environment."]}),"\n",(0,i.jsx)(n.h3,{id:"running-a-local-development-server",children:"Running a local development server"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Start running Docker locally."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cd"})," into the project root and run:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker compose up --detach\nnpm run dev\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docker compose up --detach"})," starts running local docker images of Redis and DynamoDB in the background."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"npm run dev"})," starts running a local instance of the Cerebellum WebSocket server on ",(0,i.jsx)(n.strong,{children:"port 8001"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"running-the-server-in-production",children:"Running the server in production"}),"\n",(0,i.jsx)(n.p,{children:"For production, this server is dockerized and its image is used in our AWS CDK infrastructure deployment."}),"\n",(0,i.jsx)(n.p,{children:"Note: While deploying the AWS infrastructure with the CDK, the environment variables needed for the server will be added automatically during deployment."}),"\n",(0,i.jsx)(n.h3,{id:"preparing-for-production",children:"Preparing for production"}),"\n",(0,i.jsx)(n.p,{children:"To dockerize this image:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"docker login"})," to make sure you are logged in to your Dockerhub account."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cd"})," into the project root directory"]}),"\n",(0,i.jsxs)(n.li,{children:["Create a local Docker image","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker build -t <your-dockerhub-username>/<image-name>:<tag> ."})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Push the Docker image to Dockerhub","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker push <your-dockerhub-username>/<image-name>:<tag>"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"placing-server-into-production",children:"Placing server into production"}),"\n",(0,i.jsx)(n.p,{children:"To use this Docker image in production:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Install Cerebellum's CLI package globally:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"npm install --global @cerebellum/cli"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cd"})," into a folder with no ",(0,i.jsx)(n.code,{children:".git"})," repo"]}),"\n",(0,i.jsxs)(n.li,{children:["Create the CDK infrastructure deployment folder by running:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cerebellum create"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In the option asking if you want to use your server image, insert the Docker image just created."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For deploying Cerebellum's CDK and more information about our ",(0,i.jsx)(n.a,{href:"https://github.com/Cerebellum-Realtime/cli",children:"CLI"})]}),"\n",(0,i.jsx)(n.h2,{id:"whats-included",children:"What's Included"}),"\n",(0,i.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.p,{children:"Cerebellum's server implements a way to authenticate users before a WebSocket connection is established in order to protect the server. This gives our server protection from unwanted users connecting."}),"\n",(0,i.jsx)(n.p,{children:"Steps to authenticate:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Create an API key","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Checkout Cerebellum's ",(0,i.jsx)(n.a,{href:"https://github.com/Cerebellum-Realtime/cli",children:"CLI"})," for more information on deploying using Cerebellum"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Place the API key into the server ",(0,i.jsx)(n.code,{children:".env"})," as ",(0,i.jsx)(n.code,{children:"API_KEY=<your_api_key>"})]}),"\n",(0,i.jsx)(n.li,{children:"Create a separate authentication server and give it the API key"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In practice, this is how authentication works:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A client attempts to login via a separate authentication server (not Cerebellum's server)"}),"\n",(0,i.jsx)(n.li,{children:"Once the clients' login is successful, the client is given a JWT token"}),"\n",(0,i.jsx)(n.li,{children:"The client then gives the JWT token to the Cerebellum server and the Cerebellum server authenticates the JWT token"}),"\n",(0,i.jsx)(n.li,{children:"Assuming the JWT token was built with the same secret, the user is granted permission to connect to the Cerebellum server via WebSocket"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"scalable-realtime-communication",children:"Scalable Realtime Communication"}),"\n",(0,i.jsx)(n.p,{children:"To be able to handle high traffic usage, Cerebellum's server is designed to be easily scalable. To do this, we rely on a Redis cache that will act as a message facilitator between servers. This means that we can horizontally scale (i.e., add more servers) and have a way for all servers to communicate."}),"\n",(0,i.jsx)(n.h3,{id:"persistent-data-storage-capability",children:"Persistent Data Storage Capability"}),"\n",(0,i.jsx)(n.p,{children:"The Cerebellum server is designed to save realtime data to DynamoDB."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In development mode, data is written directly to a running docker instance of DynamoDB."}),"\n",(0,i.jsxs)(n.li,{children:["In production mode, the server is designed to send data to a queue.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Note: An AWS Lambda function will use Dynamoose and send data to the database."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"connection-state-recovery",children:"Connection State Recovery"}),"\n",(0,i.jsx)(n.p,{children:"The Cerebellum server is designed to handle dropped connections re-connecting quickly and without re-authentication. We use Socket.io's built-in connection state recovery. The max re-connect timeframe is set to 120 seconds and skip the middleware (which skips authentication)."}),"\n",(0,i.jsx)(n.h3,{id:"realtime-presence",children:"Realtime Presence"}),"\n",(0,i.jsx)(n.p,{children:"The Cerebellum server is designed for realtime presence. This means that our server gives the capability for users to see realtime updates from other users in their channel. We utilize Redis streams by saving the presence of channels on the Redis temporarily. The server can then implement presence by:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"adding a user to the channel's presence"}),"\n",(0,i.jsx)(n.li,{children:"removing a user from a channel's presence"}),"\n",(0,i.jsx)(n.li,{children:"getting all users from a channel's presence"}),"\n",(0,i.jsx)(n.li,{children:"updating a user's info in the channel's presence"}),"\n",(0,i.jsx)(n.li,{children:"getting all channels a user is present in"}),"\n",(0,i.jsx)(n.li,{children:"removing a user from all channel's presence"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var i=r(6540);const t={},s=i.createContext(t);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);