"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[608],{8813:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var s=n(4848),r=n(8453);const l={sidebar_position:1},t="Prerequisites",o={id:"Prerequisites",title:"Prerequisites",description:"In order for Willow to successfully replicate from PostgreSQL to Redis, the following prerequisites must be met:",source:"@site/docs/Prerequisites.md",sourceDirName:".",slug:"/Prerequisites",permalink:"/docs/Prerequisites",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"Installation & Usage",permalink:"/docs/Directions"}},a={},c=[{value:"PostgreSQL",id:"postgresql",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Using a Minimum Privileged User",id:"using-a-minimum-privileged-user",level:3},{value:"Redis",id:"redis",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h1,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(i.p,{children:"In order for Willow to successfully replicate from PostgreSQL to Redis, the following prerequisites must be met:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"PostgreSQL server is set up for logical replication"}),"\n",(0,s.jsx)(i.li,{children:"Docker is installed on the server running Willow"}),"\n",(0,s.jsx)(i.li,{children:"Redis server must have RedisJSON and RediSearch modules installed"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,s.jsxs)(i.p,{children:["Instructions are written based on ",(0,s.jsx)(i.a,{href:"https://debezium.io/documentation/reference/stable/connectors/postgresql.html#setting-up-postgresql",children:"Debezium's documentation"})," for configuring PostgreSQL. The following instructions assume that the PostgreSQL user used for replication is named ",(0,s.jsx)(i.code,{children:"willow"}),"."]}),"\n",(0,s.jsx)(i.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(i.p,{children:["Ensure your PostgreSQL server is configured to support logical replication with the ",(0,s.jsx)(i.code,{children:"pgoutput"})," plugin. This includes:"]}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Using PostgreSQL version 10+."}),"\n",(0,s.jsx)(i.li,{children:"Setting the WAL (write-ahead log) level to logical."}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sql",children:"ALTER SYSTEM SET wal_level = logical;\n"})}),"\n",(0,s.jsxs)(i.ol,{start:"3",children:["\n",(0,s.jsxs)(i.li,{children:["Adding entries to your PostgreSQL's ",(0,s.jsx)(i.code,{children:"pg_hba.conf"})," file to allow the server running Willow to replicate from the PostgreSQL host."]}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"local   replication   willow                      trust\nhost    replication   willow     127.0.0.1/32     trust\nhost    replication   willow     ::1/128          trust\n"})}),"\n",(0,s.jsxs)(i.ol,{start:"4",children:["\n",(0,s.jsx)(i.li,{children:"Restart the PostgreSQL server for the changes to take effect."}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"using-a-minimum-privileged-user",children:"Using a Minimum Privileged User"}),"\n",(0,s.jsxs)(i.p,{children:["In order to replicate data from PostgreSQL's WAL, you must provide Willow with a PostgreSQL user. This user can either be a ",(0,s.jsx)(i.code,{children:"SUPERUSER"})," or have the minimum required privileges."]}),"\n",(0,s.jsxs)(i.p,{children:["The following SQL command can be run in the PostgreSQL terminal to create a ",(0,s.jsx)(i.code,{children:"SUPERUSER"}),". Be sure to provide a unique password"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sql",children:"CREATE ROLE willow WITH LOGIN SUPERUSER PASSWORD <password>\n"})}),"\n",(0,s.jsx)(i.p,{children:"Minimum privileged users must have the following privileges:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"REPLICATION"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"LOGIN"})}),"\n",(0,s.jsxs)(i.li,{children:["database level ",(0,s.jsx)(i.code,{children:"CREATE"})]}),"\n",(0,s.jsxs)(i.li,{children:["table level ",(0,s.jsx)(i.code,{children:"SELECT"})]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The following SQL commands can be run in the PostgreSQL terminal to create a minimum privileged user:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-sql",children:"/* Create a willow user with the REPLICATION and LOGIN permissions */\nCREATE ROLE willow REPLICATION LOGIN PASSWORD <password>;\n\n\n/* Create a willow_replication group for sharing table level privileges with original table owners */\nCREATE ROLE willow_replication;\n\n\n/* Repeat the following command for all databases containing tables you wish to replicate */\n\n/* Provide willow_replication with database level CREATE privileges */\nGRANT CREATE ON DATABASE <database_name> TO willow_replication;\n\n\n/* Repeat the remaining commands for all tables you wish to replicate. */\n\n/* Place the willow user and the original table owner in the willow_replication group */\nGRANT willow_replication TO <original_table_owner>;\nGRANT willow_replication TO willow;\n\n/* Make the willow_replication group the table owner and grant SELECT permissions */\nALTER TABLE <table_name> OWNER TO willow_replication;\nGRANT SELECT ON <table_name> TO willow_replication;\n"})}),"\n",(0,s.jsx)(i.h2,{id:"redis",children:"Redis"}),"\n",(0,s.jsxs)(i.p,{children:["Ensure your Redis cache has both the RedisJSON and RediSearch modules installed. ",(0,s.jsx)(i.a,{href:"https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/",children:"Redis Stack"})," by default includes both of these modules and is a simple way to ensure your Redis cache is compatible with Willow."]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>o});var s=n(6540);const r={},l=s.createContext(r);function t(e){const i=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:i},e.children)}}}]);